@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

' Диаграмма контейнеров
LAYOUT_TOP_DOWN()
title Система менеджмента техники - Контейнеры

Person(user, "Рядовой пользователь", "Пользователь системы для получения информации о технике и задачах")
Person(admin, "Администратор", "Управляет техникой, задачами и пользователями")
Person(carrier, "Исполнитель (носящий)", "Получает задачи на перемещение техники")

Container(webApp, "Веб-приложение", "React/TypeScript", "Интерфейс для администраторов и исполнителей")
Container(telegramBot, "Телеграм-бот", "Telegram Bot API + Go", "Интерфейс для рядовых пользователей")
Container(apiGateway, "API Gateway", "Go", "Обрабатывает запросы от веб-приложения")
Container(serviceTechManagement, "Сервис управления техникой", "Go", "Управляет информацией о технике и задачах")
Container(serviceTaskManagement, "Сервис управления задачами", "Go", "Управляет задачами и исполнителями")
Container(database, "База данных", "PostgreSQL", "Хранит информацию о технике, задачах и пользователях")
Container(messageBroker, "Брокер сообщений", "NATS JetStream", "Обеспечивает асинхронное взаимодействие между сервисами")
System_Ext(telegramPlatform, "Платформа Telegram", "Telegram Bot API", "Доставляет обновления и принимает ответы")

Rel(user, telegramBot, "Использует")
Rel(admin, webApp, "Использует")
Rel(carrier, webApp, "Использует")
Rel(webApp, apiGateway, "Отправляет запросы")
Rel(telegramPlatform, telegramBot, "Доставляет обновления (webhook/polling)")
Rel(telegramBot, telegramPlatform, "Отправляет сообщения", "HTTPS")
Rel(telegramBot, messageBroker, "Подписывается и публикует команды")
Rel(apiGateway, serviceTechManagement, "Запросы о технике")
Rel(apiGateway, serviceTaskManagement, "Запросы о задачах")
Rel(serviceTechManagement, database, "Читает и записывает данные")
Rel(serviceTaskManagement, database, "Читает и записывает данные")
Rel(serviceTechManagement, messageBroker, "Публикует события")
Rel(serviceTaskManagement, messageBroker, "Публикует уведомления и подписывается на команды")

@enduml